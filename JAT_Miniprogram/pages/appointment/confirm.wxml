<!--appointment/confirm.wxml-->
<view class="container">
  <!-- 预约信息 -->
  <view class="appointment-info card">
    <view class="section-title">预约信息</view>
    <view class="info-item">
      <text class="info-label">预约日期</text>
      <text class="info-value">{{appointmentInfo.date}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">预约时间</text>
      <text class="info-value">{{appointmentInfo.timeSlot}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">服务项目</text>
      <text class="info-value">{{appointmentInfo.serviceName}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">服务时长</text>
      <text class="info-value">{{appointmentInfo.duration}}分钟</text>
    </view>
    <view class="info-item">
      <text class="info-label">技师</text>
      <text class="info-value">{{appointmentInfo.therapistName}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">门店地址</text>
      <text class="info-value">{{shopInfo.address}}</text>
    </view>
  </view>
  
  <!-- 联系人信息 -->
  <view class="contact-info card">
    <view class="section-title">联系人信息</view>
    <view class="form-item">
      <text class="form-label">姓名</text>
      <input class="form-input" type="text" placeholder="请输入姓名" value="{{contactInfo.name}}" bindinput="onNameInput" />
    </view>
    <view class="form-item">
      <text class="form-label">手机号码</text>
      <input class="form-input" type="number" placeholder="请输入手机号码" maxlength="11" value="{{contactInfo.phone}}" bindinput="onPhoneInput" />
    </view>
    <view class="form-item">
      <text class="form-label">备注</text>
      <textarea class="form-textarea" placeholder="如有特殊需求，请在此备注" value="{{contactInfo.remark}}" bindinput="onRemarkInput"></textarea>
    </view>
  </view>
  
  <!-- 支付方式 -->
  <view class="payment-method card">
    <view class="section-title">支付方式</view>
    <radio-group class="payment-options" bindchange="onPaymentChange">
      <label class="payment-option" wx:for="{{paymentMethods}}" wx:key="id">
        <view class="payment-option-content">
          <image class="payment-icon" src="{{item.icon}}" mode="aspectFit"></image>
          <view class="payment-info">
            <text class="payment-name">{{item.name}}</text>
            <text class="payment-desc" wx:if="{{item.desc}}">{{item.desc}}</text>
          </view>
        </view>
        <radio value="{{item.id}}" checked="{{item.id === selectedPayment}}" color="#3A7734" />
      </label>
    </radio-group>
  </view>
  
  <!-- 卡券选择 -->
  <view class="coupon-selection card" wx:if="{{coupons.length > 0}}">
    <view class="section-title">优惠券</view>
    <view class="coupon-selector" bindtap="showCouponList">
      <text class="coupon-text">{{selectedCoupon ? selectedCoupon.name : '不使用优惠券'}}</text>
      <text class="coupon-value" wx:if="{{selectedCoupon}}">-¥{{selectedCoupon.value}}</text>
      <image class="arrow-icon" src="/static/images/icons/arrow-right.png" mode="aspectFit"></image>
    </view>
  </view>
  
  <!-- 卡项抵扣 -->
  <view class="card-selection card" wx:if="{{cards.length > 0}}">
    <view class="section-title">会员卡</view>
    <view class="card-selector" bindtap="showCardList">
      <text class="card-text">{{selectedCard ? selectedCard.name : '不使用会员卡'}}</text>
      <text class="card-value" wx:if="{{selectedCard}}">剩余{{selectedCard.remainingCount}}次</text>
      <image class="arrow-icon" src="/static/images/icons/arrow-right.png" mode="aspectFit"></image>
    </view>
  </view>
  
  <!-- 底部结算栏 -->
  <view class="bottom-action-bar safe-bottom">
    <view class="price-info">
      <text class="price-label">实付款</text>
      <text class="price-value">¥{{finalPrice}}</text>
    </view>
    <button class="btn btn-primary" bindtap="submitAppointment" disabled="{{!canSubmit}}">提交预约</button>
  </view>
  
  <!-- 优惠券弹窗 -->
  <view class="popup-mask" wx:if="{{showCouponPopup}}" bindtap="hideCouponList"></view>
  <view class="popup-content {{showCouponPopup ? 'show' : ''}}" wx:if="{{showCouponPopup}}">
    <view class="popup-header">
      <text class="popup-title">选择优惠券</text>
      <icon type="clear" size="20" color="#999999" bindtap="hideCouponList"></icon>
    </view>
    <view class="popup-body">
      <view class="coupon-list">
        <view class="coupon-item {{item.id === selectedCoupon.id ? 'selected' : ''}}" 
          wx:for="{{coupons}}" wx:key="id" 
          bindtap="selectCoupon" data-id="{{item.id}}">
          <view class="coupon-left">
            <text class="coupon-value">¥{{item.value}}</text>
            <text class="coupon-condition" wx:if="{{item.minAmount > 0}}">满{{item.minAmount}}元可用</text>
          </view>
          <view class="coupon-right">
            <text class="coupon-name">{{item.name}}</text>
            <text class="coupon-time">{{item.validTimeDesc}}</text>
            <text class="coupon-scope">{{item.useScope}}</text>
          </view>
          <view class="coupon-check" wx:if="{{item.id === selectedCoupon.id}}">
            <icon type="success" size="20" color="#3A7734"></icon>
          </view>
        </view>
      </view>
      <view class="no-coupon-item" bindtap="selectCoupon" data-id="">
        <text>不使用优惠券</text>
      </view>
    </view>
    <view class="popup-footer">
      <button class="btn btn-primary btn-block" bindtap="confirmCoupon">确定</button>
    </view>
  </view>
  
  <!-- 会员卡弹窗 -->
  <view class="popup-mask" wx:if="{{showCardPopup}}" bindtap="hideCardList"></view>
  <view class="popup-content {{showCardPopup ? 'show' : ''}}" wx:if="{{showCardPopup}}">
    <view class="popup-header">
      <text class="popup-title">选择会员卡</text>
      <icon type="clear" size="20" color="#999999" bindtap="hideCardList"></icon>
    </view>
    <view class="popup-body">
      <view class="card-list">
        <view class="card-item {{item.id === selectedCard.id ? 'selected' : ''}}" 
          wx:for="{{cards}}" wx:key="id" 
          bindtap="selectCard" data-id="{{item.id}}">
          <view class="card-left">
            <text class="card-name">{{item.name}}</text>
            <text class="card-count">剩余{{item.remainingCount}}次</text>
          </view>
          <view class="card-right">
            <text class="card-validity">有效期至 {{item.validityDate}}</text>
          </view>
          <view class="card-check" wx:if="{{item.id === selectedCard.id}}">
            <icon type="success" size="20" color="#3A7734"></icon>
          </view>
        </view>
      </view>
      <view class="no-card-item" bindtap="selectCard" data-id="">
        <text>不使用会员卡</text>
      </view>
    </view>
    <view class="popup-footer">
      <button class="btn btn-primary btn-block" bindtap="confirmCard">确定</button>
    </view>
  </view>
</view>
